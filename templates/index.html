<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aklog - syslog server</title>
    <link rel="stylesheet" href="/static/bulma.min.css">
    <script src="/static/filters.js" type="text/javascript"></script>
    <style>
        /* Tab styling */
        /* Hide all tabs by default */
        .tab-content {
            display: none;
        }
        /* Show the first tab by default */
        #tab1 {
            display: block;
        }

        /* Message cell styling */
        .message-cell {
            max-width: 300px;
            white-space: normal;
            word-wrap: break-word;
            position: relative;
            padding: 0.5em;
            line-height: 1.2;
        }
        .message-cell:hover {
            cursor: pointer;
        }

        /* Severity styling */
        .severity-error {
            background-color: #ffebee !important; /* Light red */
        }
        .severity-warning {
            background-color: #fff8e1 !important; /* Light yellow */
        }
        .severity-info {
            background-color: #e3f2fd !important; /* Light blue */
        }
        .severity-debug {
            background-color: #f1f8e9 !important; /* Light green */
        }
        /* Override striped table styling */
        .table.is-striped tr.severity-error:nth-child(even),
        .table.is-striped tr.severity-warning:nth-child(even),
        .table.is-striped tr.severity-info:nth-child(even),
        .table.is-striped tr.severity-debug:nth-child(even) {
            background-color: inherit;
        }

        /* Host filter styling */
        #host-filter-dropdown .dropdown-content {
            max-height: 300px;
            overflow-y: auto;
        }

        #active-host-filters .tags {
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <section class="section">
        <div class="container">
            <h1 class="title is-1 has-text-centered">
                AkLog
            </h1>
            <h2 class="subtitle has-text-centered">
                A simple syslog server that stores logs in a SQLite database
            </h2>
            <div class="box">
                <p class="has-text-centered">
                    This server is currently listening for syslog messages on UDP port 514.
                </p>

                <!-- Tabs -->
                <div class="tabs is-centered">
                    <ul>
                        <li><a href="#tab1" class="tab-link" data-tab="tab1">Logs</a></li>
                        <li><a href="#tab2" class="tab-link" data-tab="tab2">Config</a></li>
                    </ul>
                </div>

                <!-- Tab Contents -->
                {{template "logs" .}}
                {{template "config" .}}
            </div>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add click event to tab links
            const tabLinks = document.querySelectorAll('.tab-link');
            const tabContents = document.querySelectorAll('.tab-content');

            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();

                    // Get the tab ID from the data-tab attribute
                    const tabId = this.getAttribute('data-tab');

                    // Hide all tab contents
                    tabContents.forEach(content => {
                        content.style.display = 'none';
                    });

                    // Show the selected tab content
                    document.getElementById(tabId).style.display = 'block';
                });
            });

            // Host filter functionality
            const hostFilterDropdown = document.getElementById('host-filter-dropdown');
            const hostFilterItems = document.querySelectorAll('.host-filter-item');
            const activeHostFilters = document.getElementById('active-host-filters');
            const logRows = document.querySelectorAll('tbody tr');

            // Set of active filters
            let activeFilters = new Set();

            // Toggle dropdown
            if (hostFilterDropdown) {
                hostFilterDropdown.querySelector('.dropdown-trigger button').addEventListener('click', function() {
                    hostFilterDropdown.classList.toggle('is-active');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!hostFilterDropdown.contains(e.target)) {
                        hostFilterDropdown.classList.remove('is-active');
                    }
                });
            }

            // Handle filter item clicks
            if (hostFilterItems) {
                hostFilterItems.forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        const ip = this.getAttribute('data-ip');

                        // Close the dropdown
                        hostFilterDropdown.classList.remove('is-active');

                        if (ip === 'all') {
                            // Clear all filters
                            activeFilters.clear();
                            updateActiveFiltersDisplay();
                            applyFilters();
                            return;
                        }

                        // Toggle the filter
                        if (activeFilters.has(ip)) {
                            activeFilters.delete(ip);
                        } else {
                            activeFilters.add(ip);
                        }

                        updateActiveFiltersDisplay();
                        applyFilters();
                    });
                });
            }

            // Update the active filters display
            function updateActiveFiltersDisplay() {
                // Clear existing tags
                const tagsContainer = activeHostFilters.querySelector('.tags');
                while (tagsContainer.children.length > 1) {
                    tagsContainer.removeChild(tagsContainer.lastChild);
                }

                // Show/hide the active filters section
                if (activeFilters.size > 0) {
                    activeHostFilters.style.display = 'block';

                    // Add new tags
                    activeFilters.forEach(ip => {
                        const tag = document.createElement('span');
                        tag.className = 'tag is-info';
                        tag.textContent = ip;

                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'delete is-small';
                        deleteBtn.addEventListener('click', function() {
                            activeFilters.delete(ip);
                            updateActiveFiltersDisplay();
                            applyFilters();
                        });

                        tag.appendChild(deleteBtn);
                        tagsContainer.appendChild(tag);
                    });
                } else {
                    activeHostFilters.style.display = 'none';
                }
            }

            // Apply filters to the log rows
            function applyFilters() {
                logRows.forEach(row => {
                    const sourceCell = row.querySelector('td:nth-child(2)');
                    if (!sourceCell) return;

                    const ip = sourceCell.textContent.trim();

                    if (activeFilters.size === 0 || activeFilters.has(ip)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }
        });
    </script>
</body>
</html>
