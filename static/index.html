<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AkLog - Syslog Server</title>
    <link rel="stylesheet" href="bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* Tab styling */
        /* Hide all tabs by default */
        .tab-content {
            display: none;
        }
        /* Show the first tab by default */
        #tab1 {
            display: block;
        }

        /* Message cell styling */
        .message-cell {
            max-width: 300px;
            white-space: normal;
            word-wrap: break-word;
            position: relative;
            padding: 0.5em;
            line-height: 1.2;
        }
        .message-cell:hover {
            cursor: pointer;
        }

        /* Severity styling */
        .severity-error {
            background-color: #ffebee !important; /* Light red */
        }
        .severity-warning {
            background-color: #fff8e1 !important; /* Light yellow */
        }
        .severity-info {
            background-color: #e3f2fd !important; /* Light blue */
        }
        .severity-debug {
            background-color: #f1f8e9 !important; /* Light green */
        }
        /* Override striped table styling */
        .table.is-striped tr.severity-error:nth-child(even),
        .table.is-striped tr.severity-warning:nth-child(even),
        .table.is-striped tr.severity-info:nth-child(even),
        .table.is-striped tr.severity-debug:nth-child(even) {
            background-color: inherit;
        }
    </style>
</head>
<body>
    <section class="section">
        <div class="container">
            <h1 class="title is-1 has-text-centered">
                AkLog
            </h1>
            <h2 class="subtitle has-text-centered">
                A simple syslog server that stores logs in a SQLite database
            </h2>
            <div class="box">
                <p class="has-text-centered">
                    This server is currently listening for syslog messages on UDP port 514.
                </p>

                <!-- Tabs -->
                <div class="tabs is-centered">
                    <ul>
                        <li><a href="#tab1" class="tab-link" data-tab="tab1">Recent Logs</a></li>
                        <li><a href="#tab2" class="tab-link" data-tab="tab2">Configuration</a></li>
                    </ul>
                </div>

                <!-- Tab Contents -->
                <div id="tab1" class="tab-content">
                    <div class="level">
                        <div class="level-left">
                            <h3 class="title is-4 level-item">Recent Logs</h3>
                        </div>
                        <div class="level-right">
                            <div class="level-item">
                                <div class="buttons are-small">
                                    <div class="control">
                                        <button id="refresh-logs" class="button is-small">
                                                <span class="icon is-small">
                                                    <i class="fas fa-sync-alt"></i>
                                                </span>
                                        </button>
                                    </div>
                                    <div class="field has-addons">
                                        <div class="control">
                                            <button id="refresh-3s" class="button is-small refresh-option">3s</button>
                                        </div>
                                        <div class="control">
                                            <button id="refresh-10s" class="button is-small refresh-option">10s</button>
                                        </div>
                                        <div class="control">
                                            <button id="refresh-60s" class="button is-small refresh-option">1m</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <table class="table is-striped is-hoverable is-fullwidth">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Source</th>
                                <th>Severity</th>
                                <th>Message</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="severity-warning">
                                <td>2023-06-15 14:32:10</td>
                                <td>192.168.1.5</td>
                                <td>Warning</td>
                                <td class="message-cell" title="Connection attempt failed due to network timeout. Multiple retry attempts were unsuccessful. Please check network configuration and try again.">Connection attempt failed due to network timeout. Multiple retry attempts were unsuccessful. Please check network configuration and try again.</td>
                            </tr>
                            <tr class="severity-info">
                                <td>2023-06-15 14:30:22</td>
                                <td>192.168.1.10</td>
                                <td>Info</td>
                                <td class="message-cell" title="Service started successfully with all components initialized properly. Database connections established and cache preloaded. System is now ready to handle incoming requests.">Service started successfully with all components initialized properly. Database connections established and cache preloaded. System is now ready to handle incoming requests.</td>
                            </tr>
                            <tr class="severity-error">
                                <td>2023-06-15 14:28:45</td>
                                <td>192.168.1.8</td>
                                <td>Error</td>
                                <td class="message-cell" title="Disk space critically low on primary storage volume. Only 2% free space remaining. Immediate action required: delete unnecessary files or expand storage capacity to prevent system failure.">Disk space critically low on primary storage volume. Only 2% free space remaining. Immediate action required: delete unnecessary files or expand storage capacity to prevent system failure.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="tab2" class="tab-content">
                    <h3 class="title is-4">Configuration</h3>

                    <h4 class="title is-5">System Stats</h4>
                    <table class="table is-striped is-hoverable is-fullwidth">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Value</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>CPU Usage</td>
                                <td>23%</td>
                                <td><span class="tag is-success">Normal</span></td>
                            </tr>
                            <tr>
                                <td>Memory Usage</td>
                                <td>45%</td>
                                <td><span class="tag is-success">Normal</span></td>
                            </tr>
                            <tr>
                                <td>Disk Space</td>
                                <td>78%</td>
                                <td><span class="tag is-warning">Warning</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 class="title is-5 mt-5">Server Settings</h4>
                    <table class="table is-striped is-hoverable is-fullwidth">
                        <thead>
                            <tr>
                                <th>Setting</th>
                                <th>Value</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Listen Port</td>
                                <td>514</td>
                                <td>UDP port for syslog messages</td>
                            </tr>
                            <tr>
                                <td>Database Path</td>
                                <td>/var/lib/aklog/logs.db</td>
                                <td>Path to SQLite database file</td>
                            </tr>
                            <tr>
                                <td>Log Retention</td>
                                <td>30 days</td>
                                <td>How long logs are kept before deletion</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add click event to tab links
            const tabLinks = document.querySelectorAll('.tab-link');
            const tabContents = document.querySelectorAll('.tab-content');

            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();

                    // Get the tab ID from the data-tab attribute
                    const tabId = this.getAttribute('data-tab');

                    // Hide all tab contents
                    tabContents.forEach(content => {
                        content.style.display = 'none';
                    });

                    // Show the selected tab content
                    document.getElementById(tabId).style.display = 'block';
                });
            });

            // Logs refresh functionality
            const refreshButton = document.getElementById('refresh-logs');
            const refresh3sButton = document.getElementById('refresh-3s');
            const refresh10sButton = document.getElementById('refresh-10s');
            const refresh60sButton = document.getElementById('refresh-60s');

            const refreshOptions = [
                { button: refresh3sButton, interval: 3 },
                { button: refresh10sButton, interval: 10 },
                { button: refresh60sButton, interval: 60 }
            ];

            let refreshTimer = null;
            let activeInterval = 0; // 0 means no auto-refresh

            // Function to highlight the active refresh option
            const highlightActiveOption = () => {
                refreshOptions.forEach(option => {
                    if (option.interval === activeInterval) {
                        option.button.classList.add('is-info');
                    } else {
                        option.button.classList.remove('is-info');
                    }
                });
            };

            // Load saved preferences from localStorage
            const loadPreferences = () => {
                const savedInterval = localStorage.getItem('refreshInterval');

                if (savedInterval) {
                    activeInterval = parseInt(savedInterval, 10);
                    highlightActiveOption();
                    if (activeInterval > 0) {
                        startAutoRefresh();
                    }
                }
            };

            // Save preferences to localStorage
            const savePreferences = () => {
                localStorage.setItem('refreshInterval', activeInterval);
            };

            // Function to refresh the page
            const refreshLogs = () => {
                window.location.reload();
            };

            // Start auto-refresh timer
            const startAutoRefresh = () => {
                // Clear any existing timer
                if (refreshTimer) {
                    clearInterval(refreshTimer);
                }

                // Start new timer if interval is greater than 0
                if (activeInterval > 0) {
                    refreshTimer = setInterval(refreshLogs, activeInterval * 1000);
                }
            };

            // Stop auto-refresh timer
            const stopAutoRefresh = () => {
                if (refreshTimer) {
                    clearInterval(refreshTimer);
                    refreshTimer = null;
                }
            };

            // Manual refresh button click
            refreshButton.addEventListener('click', refreshLogs);

            // Set up refresh option buttons
            refreshOptions.forEach(option => {
                option.button.addEventListener('click', function() {
                    // If clicking the active button, turn off auto-refresh
                    if (activeInterval === option.interval) {
                        activeInterval = 0;
                        stopAutoRefresh();
                    } else {
                        // Otherwise, set new interval and start auto-refresh
                        activeInterval = option.interval;
                        startAutoRefresh();
                    }

                    highlightActiveOption();
                    savePreferences();
                });
            });

            // Load preferences on page load
            loadPreferences();
        });
    </script>
</body>
</html>
